<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- dao의 인터페이스 주소 -->
<mapper namespace="com.tech.miaa.dao.MypagePostDao">
	<select id="mypage_post_list_page"
		resultType="com.tech.miaa.dto.MypagePostDto">
		<if test="reply_status=='전체'">
		SELECT * FROM(SELECT ROWNUM RM, IT.* FROM(SELECT
		TOTAL_ID,ITEM_ID,NULL AS ANIMAL_ID, LOSTDAY AS DAY,ADDRESS,ITEM_NAME
		AS NAME,UPKIND,USER_ID,FILENAME FROM
		(SELECT
		TOTAL_ID,ITEM_ID,LOSTDAY,ADDRESS,ITEM_NAME,UPKIND, USER_ID,FILENAME
		FROM ITEM IT LEFT OUTER JOIN (SELECT TOTAL_ID AS TOTAL2,FILENAME FROM
		ITEM_IMG
		WHERE FILE_ID IN(SELECT MIN(FILE_ID) FROM ITEM_IMG)) ITIMG ON
		IT.TOTAL_ID=ITIMG.TOTAL2) WHERE USER_ID=#{param1}
		UNION ALL
		SELECT
		TOTAL_ID,NULL AS ITEM_ID, ANIMAL_ID,MISSINGDAY AS
		DAY,ADDRESS,ANIMAL_NAME AS NAME,UPKIND,USER_ID,FILENAME FROM
		(SELECT
		TOTAL_ID,ANIMAL_ID,MISSINGDAY,ADDRESS,ANIMAL_NAME,UPKIND,USER_ID,FILENAME
		FROM ANIMAL AN LEFT OUTER JOIN (SELECT TOTAL_ID AS TOTAL2,FILENAME
		FROM ANIMAL_IMG WHERE FILE_ID IN
		(SELECT MIN(FILE_ID) FROM ANIMAL_IMG))
		ANIMG ON AN.TOTAL_ID=ANIMG.TOTAL2)
		WHERE USER_ID=#{param1} ORDER BY
		TOTAL_ID DESC) IT ) WHERE RM BETWEEN #{param2} AND #{param3}
		</if>
		<if test="reply_status=='물건'">
		SELECT * FROM(SELECT ROWNUM RM,TOT.* FROM (SELECT	TOTAL_ID,ITEM_ID,NULL AS ANIMAL_ID, LOSTDAY AS DAY,ADDRESS,ITEM_NAME
		AS NAME,UPKIND,USER_ID,FILENAME FROM
		(SELECT
		TOTAL_ID,ITEM_ID,LOSTDAY,ADDRESS,ITEM_NAME,UPKIND, USER_ID,FILENAME
		FROM ITEM IT LEFT OUTER JOIN (SELECT TOTAL_ID AS TOTAL2,FILENAME FROM
		ITEM_IMG
		WHERE FILE_ID IN(SELECT MIN(FILE_ID) FROM ITEM_IMG)) ITIMG ON
		IT.TOTAL_ID=ITIMG.TOTAL2) WHERE USER_ID=#{param1} ORDER BY TOTAL_ID DESC)TOT) WHERE RM BETWEEN #{param2} AND #{param3}
		</if>
		<if test="reply_status=='동물'">
		SELECT * FROM(SELECT ROWNUM RM,TOT.* FROM(SELECT  TOTAL_ID,NULL AS ITEM_ID, ANIMAL_ID,MISSINGDAY AS
		DAY,ADDRESS,ANIMAL_NAME AS NAME,UPKIND,USER_ID,FILENAME FROM
		(SELECT TOTAL_ID,ANIMAL_ID,MISSINGDAY,ADDRESS,ANIMAL_NAME,UPKIND,USER_ID,FILENAME
		FROM ANIMAL AN LEFT OUTER JOIN (SELECT TOTAL_ID AS TOTAL2,FILENAME
		FROM ANIMAL_IMG WHERE FILE_ID IN (SELECT MIN(FILE_ID) FROM ANIMAL_IMG))
		ANIMG ON AN.TOTAL_ID=ANIMG.TOTAL2) WHERE USER_ID=#{param1} ORDER BY TOTAL_ID DESC)TOT) 
		WHERE RM BETWEEN #{param2} AND #{param3}
		</if>
	</select>
	<select id="totalCount" resultType="Integer">
		<if test="reply_status=='전체'">
		SELECT COUNT(*) FROM (SELECT TOTAL_ID,ITEM_ID,NULL
		AS ANIMAL_ID, LOSTDAY AS DAY,ADDRESS,ITEM_NAME AS
		NAME,UPKIND,USER_ID,FILENAME FROM
		(SELECT TOTAL_ID,ITEM_ID,LOSTDAY,ADDRESS,ITEM_NAME,UPKIND, USER_ID,FILENAME
		FROM ITEM IT LEFT OUTER JOIN (SELECT TOTAL_ID AS TOTAL2,FILENAME FROM
		ITEM_IMG
		WHERE FILE_ID IN(SELECT MIN(FILE_ID) FROM ITEM_IMG)) ITIMG ON
		IT.TOTAL_ID=ITIMG.TOTAL2) WHERE USER_ID=#{param1}
		UNION ALL
		SELECT TOTAL_ID,NULL AS ITEM_ID, ANIMAL_ID,MISSINGDAY AS
		DAY,ADDRESS,ANIMAL_NAME AS NAME,UPKIND,USER_ID,FILENAME FROM
		(SELECT
		TOTAL_ID,ANIMAL_ID,MISSINGDAY,ADDRESS,ANIMAL_NAME,UPKIND,USER_ID,FILENAME
		FROM ANIMAL AN LEFT OUTER JOIN (SELECT TOTAL_ID AS TOTAL2,FILENAME
		FROM ANIMAL_IMG WHERE FILE_ID IN
		(SELECT MIN(FILE_ID) FROM ANIMAL_IMG)) ANIMG ON AN.TOTAL_ID=ANIMG.TOTAL2)
		WHERE USER_ID=#{param1})
		</if>
		<if test="reply_status=='물건'">
		SELECT count(*) FROM(SELECT ROWNUM RM,TOT.* FROM (SELECT	TOTAL_ID,ITEM_ID,NULL AS ANIMAL_ID, LOSTDAY AS DAY,ADDRESS,ITEM_NAME
		AS NAME,UPKIND,USER_ID,FILENAME FROM
		(SELECT
		TOTAL_ID,ITEM_ID,LOSTDAY,ADDRESS,ITEM_NAME,UPKIND, USER_ID,FILENAME
		FROM ITEM IT LEFT OUTER JOIN (SELECT TOTAL_ID AS TOTAL2,FILENAME FROM
		ITEM_IMG
		WHERE FILE_ID IN(SELECT MIN(FILE_ID) FROM ITEM_IMG)) ITIMG ON
		IT.TOTAL_ID=ITIMG.TOTAL2) WHERE USER_ID=#{param1} ORDER BY TOTAL_ID DESC)TOT)
		</if>
		<if test="reply_status=='동물'">
		SELECT count(*) FROM(SELECT ROWNUM RM,TOT.* FROM(SELECT  TOTAL_ID,NULL AS ITEM_ID, ANIMAL_ID,MISSINGDAY AS
		DAY,ADDRESS,ANIMAL_NAME AS NAME,UPKIND,USER_ID,FILENAME FROM
		(SELECT TOTAL_ID,ANIMAL_ID,MISSINGDAY,ADDRESS,ANIMAL_NAME,UPKIND,USER_ID,FILENAME
		FROM ANIMAL AN LEFT OUTER JOIN (SELECT TOTAL_ID AS TOTAL2,FILENAME
		FROM ANIMAL_IMG WHERE FILE_ID IN (SELECT MIN(FILE_ID) FROM ANIMAL_IMG))
		ANIMG ON AN.TOTAL_ID=ANIMG.TOTAL2) WHERE USER_ID=#{param1} ORDER BY TOTAL_ID DESC)TOT)
		</if>
	</select>

</mapper>